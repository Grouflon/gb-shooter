IF  !DEF(__SOUND_DEF__)
__SOUND_DEF__ SET 1

WAVEP_1_8	EQU %00
WAVEP_1_4	EQU %01
WAVEP_1_2	EQU %10
WAVEP_3_4	EQU %11

WAVEMODE_MUTE	EQU	%00
WAVEMODE_NOP	EQU	%01
WAVEMODE_SHIFT1	EQU	%10
WAVEMODE_SHIFT2	EQU	%11


;****************************
;*         CHANNEL 1        *
;****************************
	
; \1 - Sweep Time (3 bits | 0-7)
; \2 - Sweep Increase/decrease (1 bit | 0-1)
; \3 - Number of sweep shifts (3 bits | 0-7)
CH1_SWEEP:	MACRO
	ld	a,	(\1*16) | (\2*8) | \3
	ld	[rNR10],	a
ENDM

CH1_LEN:	MACRO
	ld	a,	(\1*64) | 63-\2
	ld	[rNR11],	a
ENDM

CH1_ENV:	MACRO
	ld	a,	(\1*16) | (\2*8) | \3
	ld	[rNR12],	a
ENDM

CH1_PLAY:	MACRO
GB_FREQ		EQU	(2048.0 - DIV(131072.0, \1))>>16

	ld	a,	$FF & GB_FREQ
	ld	[rNR13],	a
	ld	a,	(GB_FREQ >> 8) | (\2 * 64) | %10000000
	ld	[rNR14],	a

PURGE	GB_FREQ
ENDM

;****************************
;*         CHANNEL 2        *
;****************************

CH2_LEN:	MACRO
	ld	a,	(\1*64) | 63-\2
	ld	[rNR21],	a
ENDM

CH2_ENV:	MACRO
	ld	a,	(\1*16) | (\2*8) | \3
	ld	[rNR22],	a
ENDM

CH2_PLAY:	MACRO
GB_FREQ		EQU	(2048.0 - DIV(131072.0, \1))>>16

	ld	a,	$FF & GB_FREQ
	ld	[rNR23],	a
	ld	a,	(GB_FREQ >> 8) | (\2 * 64) | %10000000
	ld	[rNR24],	a

PURGE	GB_FREQ
ENDM



;****************************
;*         CHANNEL 3        *
;****************************

CH3_ON:		MACRO
	ld	a,			\1*128
	ld	[rNR30],	a
ENDM

CH3_LEN:	MACRO
	ld	a,			255 - \1
	ld	[rNR31],	a
ENDM

CH3_MODE:	MACRO
	ld		a,			\1*32
	ld		[rNR32],	a
ENDM

CH3_PLAY:	MACRO
GB_FREQ		EQU	(2048.0 - DIV(131072.0, \1))>>16

	ld	a,	$FF & GB_FREQ
	ld	[rNR33],	a
	ld	a,			(GB_FREQ >> 8) | (\2 * 64) | %10000000
	ld	[rNR34],	a

PURGE	GB_FREQ
ENDM


;****************************
;*         CHANNEL 4        *
;****************************

CH4_LEN:	MACRO
	ld	a,	(63-\1)
	ld	[rNR41],	a
ENDM

CH4_ENV:	MACRO
	ld	a,	(\1*16) | (\2*8) | \3
	ld	[rNR42],	a
ENDM

CH4_MODE:	MACRO
	ld	a,			\1
	ld	[rNR42_2],	a
ENDM

CH4_PLAY:	MACRO
	ld	a,	%10000000 | \1<<6
	ld	[rNR43],	a
ENDM

;****************************
;*        NOTES FREQS       *
;****************************

FREQ_C0		EQU	16.352
FREQ_Db0	EQU	17.324
FREQ_D0		EQU	18.351
FREQ_Eb0	EQU 19.445
FREQ_E0		EQU	20.602
FREQ_F0		EQU	21.827
FREQ_Gb0	EQU	23.125
FREQ_G0		EQU	24.500
FREQ_Ab0	EQU	25.957
FREQ_A0		EQU	27.500
FREQ_Bb0	EQU	29.135
FREQ_B0		EQU	30.868

FREQ_C1		EQU	32.703
FREQ_Db1	EQU	34.648
FREQ_D1		EQU	36.708
FREQ_Eb1	EQU 38.891
FREQ_E1		EQU	41.203
FREQ_F1		EQU	43.654
FREQ_Gb1	EQU	46.249
FREQ_G1		EQU	48.999
FREQ_Ab1	EQU	51.913
FREQ_A1		EQU	55.000
FREQ_Bb1	EQU	58.270
FREQ_B1		EQU	61.735

FREQ_C2		EQU 65.406
FREQ_Db2	EQU 69.296
FREQ_D2		EQU 73.416
FREQ_Eb2	EQU 77.782
FREQ_E2		EQU 82.407
FREQ_F2		EQU 87.307
FREQ_Gb2	EQU 92.499
FREQ_G2		EQU 97.999
FREQ_Ab2	EQU 103.83
FREQ_A2		EQU 110.00
FREQ_Bb2	EQU 116.57
FREQ_B2		EQU 123.47

FREQ_C3		EQU 130.81
FREQ_Db3	EQU 138.59
FREQ_D3		EQU 146.83
FREQ_Eb3	EQU 155.56
FREQ_E3		EQU 164.81
FREQ_F3		EQU 174.61
FREQ_Gb3	EQU 185.00
FREQ_G3		EQU 196.00
FREQ_Ab3	EQU 207.65
FREQ_A3		EQU 220.00
FREQ_Bb3	EQU 233.08
FREQ_B3		EQU 246.94

FREQ_C4		EQU 261.63
FREQ_Db4	EQU 277.18
FREQ_D4		EQU 293.66
FREQ_Eb4	EQU 311.13
FREQ_E4		EQU 329.63
FREQ_F4		EQU 349.23
FREQ_Gb4	EQU 369.99
FREQ_G4		EQU 392.00
FREQ_Ab4	EQU 415.30
FREQ_A4		EQU 440.00
FREQ_Bb4	EQU 466.16
FREQ_B4		EQU 493.88

FREQ_C5		EQU 523.25
FREQ_Db5	EQU 554.37
FREQ_D5		EQU 587.33
FREQ_Eb5	EQU 622.25
FREQ_E5		EQU 659.26
FREQ_F5		EQU 698.46
FREQ_Gb5	EQU 739.99
FREQ_G5		EQU 783.99
FREQ_Ab5	EQU 830.61
FREQ_A5		EQU 880.00
FREQ_Bb5	EQU 932.33
FREQ_B5		EQU 987.77

FREQ_C6		EQU 1046.5
FREQ_Db6	EQU 1108.7
FREQ_D6		EQU 1174.7
FREQ_Eb6	EQU 1244.5
FREQ_E6		EQU 1318.5
FREQ_F6		EQU 1396.9
FREQ_Gb6	EQU 1480.0
FREQ_G6		EQU 1568.0
FREQ_Ab6	EQU 1661.2
FREQ_A6		EQU 1760.0
FREQ_Bb6	EQU 1864.7
FREQ_B6		EQU 1975.5

FREQ_C7		EQU 2093.0
FREQ_Db7	EQU 2217.5
FREQ_D7		EQU 2349.3
FREQ_Eb7	EQU 2489.0
FREQ_E7		EQU 2637.0
FREQ_F7		EQU 2793.8
FREQ_Gb7	EQU 2960.0
FREQ_G7		EQU 3136.0
FREQ_Ab7	EQU 3322.4
FREQ_A7		EQU 3520.0
FREQ_Bb7	EQU 3729.3
FREQ_B7		EQU 3951.1

FREQ_C8		EQU 4186.0
FREQ_Db8	EQU 4434.9
FREQ_D8		EQU 4698.6
FREQ_Eb8	EQU 4978.0
FREQ_E8		EQU 5274.0
FREQ_F8		EQU 5587.7
FREQ_Gb8	EQU 5919.9
FREQ_G8		EQU 6271.9
FREQ_Ab8	EQU 6644.9
FREQ_A8		EQU 7040.0
FREQ_Bb8	EQU 7458.6
FREQ_B8		EQU 7902.1

;****************************
;*       FREQS MEMORY       *
;****************************

TRIGGER_REG_VALUE EQU %10000000

C0	EQU ((2048.0 - DIV(131072.0, FREQ_C0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Db0	EQU ((2048.0 - DIV(131072.0, FREQ_Db0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
D0	EQU ((2048.0 - DIV(131072.0, FREQ_D0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Eb0	EQU ((2048.0 - DIV(131072.0, FREQ_Eb0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
E0	EQU ((2048.0 - DIV(131072.0, FREQ_E0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
F0	EQU ((2048.0 - DIV(131072.0, FREQ_F0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Gb0	EQU ((2048.0 - DIV(131072.0, FREQ_Gb0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
G0	EQU ((2048.0 - DIV(131072.0, FREQ_G0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Ab0	EQU ((2048.0 - DIV(131072.0, FREQ_Ab0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
A0	EQU ((2048.0 - DIV(131072.0, FREQ_A0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Bb0	EQU ((2048.0 - DIV(131072.0, FREQ_Bb0)) >> 16)	| (TRIGGER_REG_VALUE << 8)
B0	EQU ((2048.0 - DIV(131072.0, FREQ_B0)) >> 16)	| (TRIGGER_REG_VALUE << 8)

C1	EQU ((2048.0 - DIV(131072.0, FREQ_C1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Db1	EQU ((2048.0 - DIV(131072.0, FREQ_Db1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
D1	EQU ((2048.0 - DIV(131072.0, FREQ_D1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Eb1	EQU ((2048.0 - DIV(131072.0, FREQ_Eb1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
E1	EQU ((2048.0 - DIV(131072.0, FREQ_E1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
F1	EQU ((2048.0 - DIV(131072.0, FREQ_F1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Gb1	EQU ((2048.0 - DIV(131072.0, FREQ_Gb1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
G1	EQU ((2048.0 - DIV(131072.0, FREQ_G1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Ab1	EQU ((2048.0 - DIV(131072.0, FREQ_Ab1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
A1	EQU ((2048.0 - DIV(131072.0, FREQ_A1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Bb1	EQU ((2048.0 - DIV(131072.0, FREQ_Bb1)) >> 16)	| (TRIGGER_REG_VALUE << 8)
B1	EQU ((2048.0 - DIV(131072.0, FREQ_B1)) >> 16)	| (TRIGGER_REG_VALUE << 8)

C2	EQU ((2048.0 - DIV(131072.0, FREQ_C2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Db2	EQU ((2048.0 - DIV(131072.0, FREQ_Db2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
D2	EQU ((2048.0 - DIV(131072.0, FREQ_D2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Eb2	EQU ((2048.0 - DIV(131072.0, FREQ_Eb2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
E2	EQU ((2048.0 - DIV(131072.0, FREQ_E2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
F2	EQU ((2048.0 - DIV(131072.0, FREQ_F2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Gb2	EQU ((2048.0 - DIV(131072.0, FREQ_Gb2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
G2	EQU ((2048.0 - DIV(131072.0, FREQ_G2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Ab2	EQU ((2048.0 - DIV(131072.0, FREQ_Ab2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
A2	EQU ((2048.0 - DIV(131072.0, FREQ_A2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Bb2	EQU ((2048.0 - DIV(131072.0, FREQ_Bb2)) >> 16)	| (TRIGGER_REG_VALUE << 8)
B2	EQU ((2048.0 - DIV(131072.0, FREQ_B2)) >> 16)	| (TRIGGER_REG_VALUE << 8)

C3	EQU ((2048.0 - DIV(131072.0, FREQ_C3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Db3	EQU ((2048.0 - DIV(131072.0, FREQ_Db3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
D3	EQU ((2048.0 - DIV(131072.0, FREQ_D3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Eb3	EQU ((2048.0 - DIV(131072.0, FREQ_Eb3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
E3	EQU ((2048.0 - DIV(131072.0, FREQ_E3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
F3	EQU ((2048.0 - DIV(131072.0, FREQ_F3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Gb3	EQU ((2048.0 - DIV(131072.0, FREQ_Gb3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
G3	EQU ((2048.0 - DIV(131072.0, FREQ_G3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Ab3	EQU ((2048.0 - DIV(131072.0, FREQ_Ab3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
A3	EQU ((2048.0 - DIV(131072.0, FREQ_A3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Bb3	EQU ((2048.0 - DIV(131072.0, FREQ_Bb3)) >> 16)	| (TRIGGER_REG_VALUE << 8)
B3	EQU ((2048.0 - DIV(131072.0, FREQ_B3)) >> 16)	| (TRIGGER_REG_VALUE << 8)

C4	EQU ((2048.0 - DIV(131072.0, FREQ_C4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Db4	EQU ((2048.0 - DIV(131072.0, FREQ_Db4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
D4	EQU ((2048.0 - DIV(131072.0, FREQ_D4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Eb4	EQU ((2048.0 - DIV(131072.0, FREQ_Eb4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
E4	EQU ((2048.0 - DIV(131072.0, FREQ_E4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
F4	EQU ((2048.0 - DIV(131072.0, FREQ_F4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Gb4	EQU ((2048.0 - DIV(131072.0, FREQ_Gb4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
G4	EQU ((2048.0 - DIV(131072.0, FREQ_G4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Ab4	EQU ((2048.0 - DIV(131072.0, FREQ_Ab4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
A4	EQU ((2048.0 - DIV(131072.0, FREQ_A4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Bb4	EQU ((2048.0 - DIV(131072.0, FREQ_Bb4)) >> 16)	| (TRIGGER_REG_VALUE << 8)
B4	EQU ((2048.0 - DIV(131072.0, FREQ_B4)) >> 16)	| (TRIGGER_REG_VALUE << 8)

C5	EQU ((2048.0 - DIV(131072.0, FREQ_C5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Db5	EQU ((2048.0 - DIV(131072.0, FREQ_Db5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
D5	EQU ((2048.0 - DIV(131072.0, FREQ_D5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Eb5	EQU ((2048.0 - DIV(131072.0, FREQ_Eb5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
E5	EQU ((2048.0 - DIV(131072.0, FREQ_E5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
F5	EQU ((2048.0 - DIV(131072.0, FREQ_F5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Gb5	EQU ((2048.0 - DIV(131072.0, FREQ_Gb5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
G5	EQU ((2048.0 - DIV(131072.0, FREQ_G5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Ab5	EQU ((2048.0 - DIV(131072.0, FREQ_Ab5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
A5	EQU ((2048.0 - DIV(131072.0, FREQ_A5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Bb5	EQU ((2048.0 - DIV(131072.0, FREQ_Bb5)) >> 16)	| (TRIGGER_REG_VALUE << 8)
B5	EQU ((2048.0 - DIV(131072.0, FREQ_B5)) >> 16)	| (TRIGGER_REG_VALUE << 8)

C6	EQU ((2048.0 - DIV(131072.0, FREQ_C6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Db6	EQU ((2048.0 - DIV(131072.0, FREQ_Db6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
D6	EQU ((2048.0 - DIV(131072.0, FREQ_D6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Eb6	EQU ((2048.0 - DIV(131072.0, FREQ_Eb6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
E6	EQU ((2048.0 - DIV(131072.0, FREQ_E6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
F6	EQU ((2048.0 - DIV(131072.0, FREQ_F6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Gb6	EQU ((2048.0 - DIV(131072.0, FREQ_Gb6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
G6	EQU ((2048.0 - DIV(131072.0, FREQ_G6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Ab6	EQU ((2048.0 - DIV(131072.0, FREQ_Ab6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
A6	EQU ((2048.0 - DIV(131072.0, FREQ_A6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Bb6	EQU ((2048.0 - DIV(131072.0, FREQ_Bb6)) >> 16)	| (TRIGGER_REG_VALUE << 8)
B6	EQU ((2048.0 - DIV(131072.0, FREQ_B6)) >> 16)	| (TRIGGER_REG_VALUE << 8)

C7	EQU ((2048.0 - DIV(131072.0, FREQ_C7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Db7	EQU ((2048.0 - DIV(131072.0, FREQ_Db7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
D7	EQU ((2048.0 - DIV(131072.0, FREQ_D7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Eb7	EQU ((2048.0 - DIV(131072.0, FREQ_Eb7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
E7	EQU ((2048.0 - DIV(131072.0, FREQ_E7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
F7	EQU ((2048.0 - DIV(131072.0, FREQ_F7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Gb7	EQU ((2048.0 - DIV(131072.0, FREQ_Gb7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
G7	EQU ((2048.0 - DIV(131072.0, FREQ_G7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Ab7	EQU ((2048.0 - DIV(131072.0, FREQ_Ab7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
A7	EQU ((2048.0 - DIV(131072.0, FREQ_A7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Bb7	EQU ((2048.0 - DIV(131072.0, FREQ_Bb7)) >> 16)	| (TRIGGER_REG_VALUE << 8)
B7	EQU ((2048.0 - DIV(131072.0, FREQ_B7)) >> 16)	| (TRIGGER_REG_VALUE << 8)

C8	EQU ((2048.0 - DIV(131072.0, FREQ_C8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Db8	EQU ((2048.0 - DIV(131072.0, FREQ_Db8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
D8	EQU ((2048.0 - DIV(131072.0, FREQ_D8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Eb8	EQU ((2048.0 - DIV(131072.0, FREQ_Eb8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
E8	EQU ((2048.0 - DIV(131072.0, FREQ_E8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
F8	EQU ((2048.0 - DIV(131072.0, FREQ_F8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Gb8	EQU ((2048.0 - DIV(131072.0, FREQ_Gb8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
G8	EQU ((2048.0 - DIV(131072.0, FREQ_G8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Ab8	EQU ((2048.0 - DIV(131072.0, FREQ_Ab8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
A8	EQU ((2048.0 - DIV(131072.0, FREQ_A8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
Bb8	EQU ((2048.0 - DIV(131072.0, FREQ_Bb8)) >> 16)	| (TRIGGER_REG_VALUE << 8)
B8	EQU ((2048.0 - DIV(131072.0, FREQ_B8)) >> 16)	| (TRIGGER_REG_VALUE << 8)

ENDC    ; __SOUND_DEF__
